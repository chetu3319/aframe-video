!function(e){var t={};function i(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t){AFRAME.registerComponent("video",{schema:{src:{type:"string"},volume:{type:"number",default:.5},loop:{type:"boolean",deafualt:!1},positional:{type:"boolean",default:!0},distanceModel:{type:"string",default:"inverse"},rolloffFactor:{type:"number",default:1},refDistance:{type:"number",default:1},maxDistance:{type:"number",default:1e4},coneInnerAngle:{type:"number",default:360},coneOuterAngle:{type:"number",default:0},coneOuterGain:{type:"number",default:0},play:{type:"boolean",default:!1},mute:{type:"boolean",default:!1}},init(){let e=document.createElement("meta");e.name="apple-mobile-web-app-capable",e.content="yes",document.querySelector("head").appendChild(e);const t=this.el.sceneEl;t.audioListener=t.audioListener||new THREE.AudioListener,t.camera&&t.camera.add(t.audioListener),t.addEventListener("camera-set-active",(function(e){e.detail.cameraEl.getObject3D("camera").add(t.audioListener)}))},update(e){let t=!1;this.data.src&&this.data.src!=e.src&&(t=!0),this.data.positional!=e.positional&&(t=!0),(async()=>{1==t&&(await this.updateSrc(),t=!1),this.video&&(1==this.data.play?(this.video.play(),this.el.emit("playback_started")):(this.video.pause(),this.el.emit("playback_stopped")),this.video.muted=this.data.mute,this.audio.gain.gain.value=this.data.volume,this.video.loop=this.data.loop)})()},async updateSrc(){const e=this.data.src;let t;this.cleanup(),this.mesh&&this.mesh.material&&(this.mesh.material.map=null,this.mesh.material.needsUpdate=!0);try{if(t=await this.createVideoTexture(e),this.data.src!==e)return void this.cleanup();this.audioSetup(t),this.video=t.image,this.video.loop=this.data.loop}catch(e){console.error("Error loading video",this.data.src,e)}this.mesh||this.planeGeometry();let i=["varying vec2 vUv;","void main(void)","{","vUv = uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),a=["uniform sampler2D texture;","varying vec2 vUv;","void main(void)","{","vec3 tColor = texture2D( texture, vUv ).rgb;","gl_FragColor = vec4(tColor, 1);","}"].join("\n");this.mesh.material.dispose(),this.mesh.material=new THREE.ShaderMaterial({uniforms:{texture:{value:t}},vertexShader:i,fragmentShader:a}),this.mesh.material.needsUpdate=!0,this.mesh.material.transparent=!1;let n=t.image.videoHeight/t.image.videoWidth;this.mesh.scale.set(1,1*n,1)},audioSetup(e){this.el.getObject3D("sound")&&(this.el.removeObject3D("sound"),e.audioSource=null),e.audioSource=this.el.sceneEl.audioListener.context.createMediaElementSource(e.image),1==this.data.positional?(this.audio=new THREE.PositionalAudio(this.el.sceneEl.audioListener),this.audio.setDistanceModel(this.data.distanceModel),this.audio.setRolloffFactor(this.data.rolloffFactor),this.audio.setRefDistance(this.data.refDistance),this.audio.setMaxDistance(this.data.maxDistance),this.audio.panner.coneInnerAngle=this.data.coneInnerAngle,this.audio.panner.coneOuterAngle=this.data.coneOuterAngle,this.audio.panner.coneOuterGain=this.data.coneOuterGain):this.audio=new THREE.Audio(this.el.sceneEl.audioListener),this.audio.setNodeSource(e.audioSource),this.el.setObject3D("sound",this.audio)},cleanup(){if(this.mesh&&this.mesh.material){const e=this.mesh.material.uniforms.texture.value;if(e.image instanceof HTMLVideoElement){e.image.pause()}this.el.removeObject3D("mesh"),this.mesh.geometry.dispose(),this.mesh.material.dispose(),this.mesh=null,e.dispose()}},planeGeometry(){let e=new THREE.PlaneBufferGeometry,t=new THREE.MeshBasicMaterial({side:2});this.mesh=new THREE.Mesh(e,t),this.el.setObject3D("mesh",this.mesh)},createVideoTexture(e){return new Promise(async(t,i)=>{const a=await this.createVideoEl(),n=new THREE.VideoTexture(a);n.minFilter=THREE.LinearFilter,n.encoding=THREE.sRGBEncoding,a.src=e,a.onerror=i;let o=!1;const s=()=>{o||(o=!0,this.el.emit("video-canplay"),t(n))};a.addEventListener("canplay",s,{once:!0}),a.addEventListener("loadedmetadata",s,{once:!0})})},async createVideoEl(){const e=document.createElement("video");return e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline",""),e.autoplay=!1,e.muted=!0,e.preload="auto",e.crossOrigin="anonymous",e},remove:function(){this.cleanup()}})}]);